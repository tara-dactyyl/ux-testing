<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerityRI Powered AI Insights</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: auto;
            overflow-y: auto;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f7;
            color: #313437;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        header {
            background: white;
            border-bottom: 1px solid #e5e5e7;
            padding: 24px 0;
            margin-bottom: 32px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
        }

        h1 {
            font-size: 32px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 4px;
        }

        .subtitle {
            color: #6e6e73;
            font-size: 16px;
        }

        .card {
            background: white;
            border-radius: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            margin-bottom: 24px;
        }

        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 28px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #e5e5e7;
        }

        .config-header:hover {
            background: #fafafa;
        }

        .config-header.collapsed {
            border-bottom: none;
        }

        .config-title {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .config-title h2 {
            font-size: 20px;
            font-weight: 600;
            color: #313437;
        }

        .config-title p {
            font-size: 14px;
            color: #6e6e73;
        }

        .config-summary {
            display: flex;
            gap: 24px;
            font-size: 14px;
            color: #6e6e73;
        }

        .config-summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-summary-item strong {
            color: #313437;
            font-weight: 600;
        }

        .toggle-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6e6e73;
            transition: transform 0.3s;
        }

        .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .config-content {
            padding: 28px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .config-content.hidden {
            display: none;
        }

        .selector-group {
            display: flex;
            flex-direction: column;
        }

        .selector-label {
            font-size: 14px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selection-count {
            font-size: 12px;
            font-weight: 500;
            color: #6e6e73;
            background: #f5f5f7;
            padding: 4px 10px;
            border-radius: 0;
        }

        .selector-box {
            background: #fafafa;
            border: 1px solid #e5e5e7;
            border-radius: 0;
            padding: 12px;
            max-height: 280px;
            overflow-y: auto;
            transition: all 0.2s;
        }

        .selector-box:hover {
            border-color: #313437;
        }

        .selector-box:focus-within {
            border-color: #313437;
            box-shadow: 0 0 0 3px rgba(49, 52, 55, 0.1);
        }

        .selector-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 0;
            cursor: pointer;
            transition: background 0.15s;
            font-size: 14px;
        }

        .selector-item:hover {
            background: rgba(49, 52, 55, 0.08);
        }

        .selector-item.parent {
            font-weight: 500;
            margin-top: 4px;
        }

        .selector-item.child {
            padding-left: 32px;
            font-size: 13px;
            color: #6e6e73;
        }

        .selector-item.grandchild {
            padding-left: 56px;
            font-size: 13px;
            color: #86868b;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            accent-color: #313437;
            cursor: pointer;
        }

        .expand-arrow {
            width: 16px;
            height: 16px;
            margin-right: 6px;
            color: #6e6e73;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .expand-arrow.expanded {
            transform: rotate(90deg);
        }

        .action-bar {
            padding: 20px 28px;
            background: #fafafa;
            border-top: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: white;
            color: #313437;
            border: 1px solid #e5e5e7;
        }

        .btn-secondary:hover {
            background: #f5f5f7;
        }

        .btn-primary {
            background: #F2E742;
            color: #313437;
        }

        .btn-primary:hover {
            background: #e6db3a;
        }

        .btn-primary:disabled {
            background: #b3b3b3;
            cursor: not-allowed;
        }

        .generate-section {
            padding: 28px;
            border-bottom: 1px solid #e5e5e7;
        }

        .generate-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            background: transparent;
            color: #6e6e73;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #e8e8ed;
        }

        .tab.active {
            background: transparent;
            color: #313437;
            border: 1px solid #313437;
        }

        .summary-content {
            padding: 28px;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .summary-header h3 {
            font-size: 24px;
            font-weight: 600;
            color: #313437;
        }

        .btn-download {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e5e5e7;
            border-radius: 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-download:hover {
            background: #f5f5f7;
        }

        .summary-meta {
            font-size: 13px;
            color: #6e6e73;
            margin-bottom: 24px;
        }

        .summary-box {
            background: #fafafa;
            border: 1px solid #e5e5e7;
            border-radius: 0;
            padding: 20px;
            min-height: 160px;
            font-size: 15px;
            line-height: 1.6;
            color: #313437;
        }

        .deeper-findings {
            padding: 28px;
        }

        .deeper-findings h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .deeper-findings p {
            font-size: 14px;
            color: #6e6e73;
            margin-bottom: 24px;
        }

        .findings-grid {
            display: grid;
            gap: 16px;
        }

        .finding-card {
            background: #fafafa;
            border: 1px solid #e5e5e7;
            border-radius: 0;
            padding: 20px;
            min-height: 140px;
            transition: all 0.2s;
            position: relative;
        }

        .finding-card:hover {
            border-color: #313437;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .finding-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .finding-title {
            font-size: 16px;
            font-weight: 600;
            color: #313437;
        }

        .show-graphic {
            font-size: 13px;
            color: #313437;
            background: transparent;
            border: none;
            padding: 6px 12px;
            text-decoration: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .show-graphic:hover {
            background: rgba(49, 52, 55, 0.05);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6e6e73;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state h4 {
            font-size: 18px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
        }

        .search-box {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #e5e5e7;
            border-radius: 0;
            font-size: 14px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .search-box:focus {
            outline: none;
            border-color: #313437;
            box-shadow: 0 0 0 3px rgba(49, 52, 55, 0.1);
        }

        @media (max-width: 1200px) {
            .config-content {
                grid-template-columns: 1fr;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(49,52,55,0.25);
            border-radius: 50%;
            border-top-color: #313437;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .selection-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            color: #313437;
            border: 1px solid #313437;
            padding: 4px 10px;
            border-radius: 0;
            font-size: 12px;
            font-weight: 500;
        }

        .select-all-btn {
            font-size: 12px;
            color: #313437;
            background: transparent;
            border: none;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
            font-weight: 500;
        }

        .select-all-btn:hover {
            color: #6e6e73;
        }

        .graphic-expanded {
            margin-top: 16px;
            padding: 20px;
            background: white;
            border: 1px solid #e5e5e7;
            min-height: 300px;
        }

        .graphic-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 260px;
            background: #fafafa;
            color: #6e6e73;
            font-size: 14px;
        }

        .back-to-top {
            text-align: center;
            padding: 40px 0;
        }

        .back-to-top-btn {
            padding: 12px 24px;
            background: transparent;
            color: #313437;
            border: 1px solid #313437;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .back-to-top-btn:hover {
            background: rgba(49, 52, 55, 0.05);
        }

        .data-summary {
            padding: 16px 28px;
            background: #fafafa;
            border-bottom: 1px solid #e5e5e7;
            font-size: 13px;
            color: #6e6e73;
            line-height: 1.8;
        }

        .data-summary strong {
            color: #313437;
            font-weight: 600;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px;
            background: #fafafa;
            border: 1px solid #e5e5e7;
            transition: all 0.2s;
        }

        .category-info {
            flex: 1;
        }

        .category-number {
            font-size: 12px;
            color: #6e6e73;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .category-name {
            font-size: 16px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 4px;
        }

        .category-subtitle {
            font-size: 13px;
            color: #6e6e73;
            line-height: 1.5;
        }

        .category-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }



        .category-content {
            padding: 20px;
            background: white;
            border: 1px solid #e5e5e7;
            border-top: none;
        }

        .category-wrapper {
            margin-bottom: 12px;
        }

        /* ── Executive Summary 4-section layout ── */
        .exec-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            border-top: 1px solid #e5e5e7;
        }

        .exec-section {
            padding: 28px;
            border-right: 1px solid #e5e5e7;
            border-bottom: 1px solid #e5e5e7;
            position: relative;
        }

        .exec-section:nth-child(2n) {
            border-right: none;
        }

        .exec-section:nth-child(3),
        .exec-section:nth-child(4) {
            border-bottom: none;
        }

        .exec-section-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-bottom: 14px;
        }

        .exec-section-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .dot-metrics   { background: #4A90D9; }
        .dot-risk      { background: #E05A5A; }
        .dot-changed   { background: #F5A623; }
        .dot-celebrate { background: #5BAD6F; }

        .label-metrics   { color: #4A90D9; }
        .label-risk      { color: #E05A5A; }
        .label-changed   { color: #F5A623; }
        .label-celebrate { color: #5BAD6F; }

        .exec-section-body {
            font-size: 14px;
            line-height: 1.7;
            color: #313437;
        }

        .exec-section-body p {
            margin-bottom: 10px;
        }

        .exec-section-body p:last-child {
            margin-bottom: 0;
        }

        .exec-section-footer {
            margin-top: 16px;
            padding-top: 14px;
            border-top: 1px solid #f0f0f0;
        }

        .chat-inline-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #313437;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .chat-inline-btn:hover {
            opacity: 1;
        }

        .chat-inline-btn svg {
            flex-shrink: 0;
        }

        /* ── Category-level chat button ── */
        .category-chat-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #6e6e73;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 6px 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: color 0.2s;
        }

        .category-chat-btn:hover {
            color: #313437;
        }

        /* ── Sliding chat panel ── */
        .chat-overlay {
            position: fixed;
            inset: 0;
            background: rgba(49,52,55,0.25);
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .chat-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        .chat-panel {
            position: fixed;
            top: 0;
            right: -520px;
            width: 480px;
            height: 100%;
            background: white;
            border-left: 1px solid #e5e5e7;
            display: flex;
            flex-direction: column;
            z-index: 101;
            transition: right 0.3s ease;
            box-shadow: -4px 0 24px rgba(0,0,0,0.08);
        }

        .chat-panel.open {
            right: 0;
        }

        .chat-panel-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-shrink: 0;
            background: #fafafa;
        }

        .chat-panel-title {
            font-size: 15px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 4px;
        }

        .chat-panel-context {
            font-size: 12px;
            color: #6e6e73;
        }

        .chat-close-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            color: #6e6e73;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: color 0.2s;
        }

        .chat-close-btn:hover {
            color: #313437;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .chat-msg {
            max-width: 90%;
            font-size: 14px;
            line-height: 1.6;
        }

        .chat-msg.ai {
            align-self: flex-start;
        }

        .chat-msg.user {
            align-self: flex-end;
        }

        .chat-msg-bubble {
            padding: 12px 16px;
            background: #f5f5f7;
            color: #313437;
            border-radius: 0;
        }

        .chat-msg.user .chat-msg-bubble {
            background: #313437;
            color: white;
        }

        .chat-msg-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #6e6e73;
            margin-bottom: 6px;
        }

        .chat-msg.user .chat-msg-label {
            text-align: right;
        }

        .chat-input-area {
            padding: 16px 24px;
            border-top: 1px solid #e5e5e7;
            flex-shrink: 0;
        }

        .chat-input-row {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #e5e5e7;
            border-radius: 0;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            transition: border-color 0.2s;
            color: #313437;
        }

        .chat-input:focus {
            outline: none;
            border-color: #313437;
        }

        .chat-send-btn {
            padding: 10px 18px;
            background: #F2E742;
            color: #313437;
            border: none;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            cursor: pointer;
            flex-shrink: 0;
            transition: background 0.2s;
        }

        .chat-send-btn:hover {
            background: #e6db3a;
        }

        .chat-context-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            color: #6e6e73;
            background: #f5f5f7;
            border: 1px solid #e5e5e7;
            padding: 4px 10px;
            margin-bottom: 10px;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 12px 16px;
            background: #f5f5f7;
            width: fit-content;
        }

        .typing-dot {
            width: 7px;
            height: 7px;
            background: #6e6e73;
            border-radius: 50%;
            animation: typingBounce 1.2s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-6px); opacity: 1; }
        }

        /* ── Past Chats ── */
        .tab-panel { }

        .past-chats-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 600px;
            border-top: 1px solid #e5e5e7;
        }

        .past-chats-sidebar {
            border-right: 1px solid #e5e5e7;
            display: flex;
            flex-direction: column;
            background: #fafafa;
        }

        .past-chats-sidebar-header {
            padding: 20px 20px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e5e5e7;
        }

        .past-chats-sidebar-title {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: #6e6e73;
        }

        .past-chats-count {
            font-size: 11px;
            font-weight: 600;
            color: #313437;
            background: #e5e5e7;
            padding: 2px 8px;
            min-width: 24px;
            text-align: center;
        }

        .past-chats-search-wrap {
            position: relative;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e5e7;
        }

        .past-chats-search-icon {
            position: absolute;
            left: 28px;
            top: 50%;
            transform: translateY(-50%);
            color: #6e6e73;
            pointer-events: none;
        }

        .past-chats-search {
            width: 100%;
            padding: 8px 12px 8px 32px;
            border: 1px solid #e5e5e7;
            background: white;
            font-size: 13px;
            color: #313437;
            font-family: inherit;
            border-radius: 0;
            transition: border-color 0.2s;
        }

        .past-chats-search:focus {
            outline: none;
            border-color: #313437;
        }

        .past-chats-list {
            flex: 1;
            overflow-y: auto;
        }

        .chat-session {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5e7;
            cursor: pointer;
            transition: background 0.15s;
        }

        .chat-session:hover { background: #f0f0f0; }

        .chat-session.active {
            background: white;
            border-left: 3px solid #313437;
        }

        .session-context-tag {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #313437;
            margin-bottom: 6px;
        }

        .session-preview {
            font-size: 13px;
            color: #6e6e73;
            line-height: 1.5;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .session-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-date { font-size: 11px; color: #86868b; }

        .session-msg-count {
            font-size: 11px;
            color: #86868b;
            background: #f0f0f0;
            padding: 2px 7px;
        }

        .past-chats-main {
            display: flex;
            flex-direction: column;
            background: white;
        }

        .session-detail-header {
            padding: 20px 28px;
            border-bottom: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background: #fafafa;
        }

        .session-detail-title {
            font-size: 16px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 4px;
        }

        .session-detail-meta { font-size: 12px; color: #6e6e73; }

        .session-detail-actions { display: flex; gap: 8px; }

        .session-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 14px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #313437;
            background: transparent;
            border: 1px solid #313437;
            cursor: pointer;
            transition: background 0.2s;
        }

        .session-action-btn:hover { background: rgba(49,52,55,0.05); }

        .session-action-btn.primary {
            background: #F2E742;
            border-color: #F2E742;
        }

        .session-action-btn.primary:hover { background: #e6db3a; }

        .session-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px 28px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 480px;
        }

        .session-msg {
            display: flex;
            flex-direction: column;
            max-width: 72%;
        }

        .session-msg.ai { align-self: flex-start; }
        .session-msg.user { align-self: flex-end; }

        .session-msg-label {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #86868b;
            margin-bottom: 5px;
        }

        .session-msg.user .session-msg-label { text-align: right; }

        .session-msg-bubble {
            padding: 13px 16px;
            font-size: 14px;
            line-height: 1.6;
            color: #313437;
            background: #f5f5f7;
        }

        .session-msg.user .session-msg-bubble {
            background: #313437;
            color: white;
        }

        .session-continue-bar {
            padding: 16px 28px;
            border-top: 1px solid #e5e5e7;
            background: #fafafa;
        }

        .session-continue-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #313437;
            background: #F2E742;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        .session-continue-btn:hover { background: #e6db3a; }

        .session-empty {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: #6e6e73;
            text-align: center;
        }

        .session-empty-icon { font-size: 40px; opacity: 0.2; margin-bottom: 16px; }

        .session-empty h4 {
            font-size: 16px;
            font-weight: 600;
            color: #313437;
            margin-bottom: 6px;
        }

        .session-empty p { font-size: 13px; }
        /* ── Category rich content ── */
        .cat-metrics-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .cat-metric {
            flex: 1;
            min-width: 100px;
            background: #fafafa;
            border: 1px solid #e5e5e7;
            padding: 14px 16px;
            text-align: center;
        }

        .cat-metric-value {
            font-size: 26px;
            font-weight: 700;
            color: #313437;
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .cat-metric-value.positive { color: #5BAD6F; }
        .cat-metric-value.negative { color: #E05A5A; }
        .cat-metric-value.neutral  { color: #4A90D9; }

        .cat-metric-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #6e6e73;
        }

        .cat-metric-delta {
            font-size: 12px;
            font-weight: 600;
            margin-top: 4px;
        }

        .delta-up   { color: #5BAD6F; }
        .delta-down { color: #E05A5A; }
        .delta-flat { color: #6e6e73; }

        .cat-insight {
            font-size: 14px;
            line-height: 1.7;
            color: #313437;
            margin-bottom: 16px;
        }

        .cat-insight p { margin-bottom: 10px; }
        .cat-insight p:last-child { margin-bottom: 0; }

        .cat-insight strong { font-weight: 600; }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            padding: 3px 10px;
            margin-left: 8px;
            vertical-align: middle;
        }

        .pill-good    { background: #e8f5eb; color: #3a8c4e; }
        .pill-warn    { background: #fef3e2; color: #b07a10; }
        .pill-risk    { background: #fdeaea; color: #c0392b; }
        .pill-neutral { background: #eef4fb; color: #2c6fac; }

        .cat-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-bottom: 16px;
        }

        .cat-table th {
            background: #f5f5f7;
            padding: 8px 12px;
            text-align: left;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #6e6e73;
            border-bottom: 1px solid #e5e5e7;
        }

        .cat-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
            color: #313437;
            vertical-align: middle;
        }

        .cat-table tr:last-child td { border-bottom: none; }
        .cat-table tr:hover td { background: #fafafa; }

        .score-bar-wrap { display: flex; align-items: center; gap: 10px; }
        .score-bar { height: 6px; background: #e5e5e7; flex: 1; max-width: 120px; }
        .score-bar-fill { height: 100%; background: #313437; }
        .score-bar-fill.good { background: #5BAD6F; }
        .score-bar-fill.warn { background: #F5A623; }
        .score-bar-fill.risk { background: #E05A5A; }

        .tag-cloud { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }

        .theme-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            border: 1px solid #e5e5e7;
            font-size: 12px;
            color: #313437;
            background: white;
        }

        .theme-tag .tag-count {
            font-size: 11px;
            font-weight: 700;
            background: #313437;
            color: white;
            padding: 1px 6px;
        }

        .theme-tag.positive-tag { border-color: #5BAD6F; }
        .theme-tag.negative-tag { border-color: #E05A5A; }

        .progress-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .progress-label { width: 160px; flex-shrink: 0; color: #313437; }
        .progress-track { flex: 1; height: 8px; background: #e5e5e7; }
        .progress-fill  { height: 100%; background: #313437; transition: width 0.8s ease; }
        .progress-fill.good { background: #5BAD6F; }
        .progress-fill.warn { background: #F5A623; }
        .progress-fill.risk { background: #E05A5A; }
        .progress-value { width: 36px; text-align: right; font-weight: 600; font-size: 13px; color: #313437; }

        .divider { border: none; border-top: 1px solid #e5e5e7; margin: 20px 0; }

        /* simple inline SVG chart container */
        .mini-chart-area {
            background: #fafafa;
            border: 1px solid #e5e5e7;
            padding: 24px;
            margin-top: 4px;
        }

        .cat-content-inner { padding: 24px; }

        @keyframes fadeInUp {
            from { opacity:0; transform: translateY(8px); }
            to   { opacity:1; transform: translateY(0); }
        }

        .cat-content-inner.animating {
            animation: fadeInUp 0.4s ease forwards;
        }
        /* ── Skeleton loader ── */
        .cat-skeleton {
            padding: 24px;
        }

        .skeleton-line {
            height: 14px;
            background: linear-gradient(90deg, #e5e5e7 25%, #f0f0f0 50%, #e5e5e7 75%);
            background-size: 200% 100%;
            animation: shimmer 1.4s infinite;
            margin-bottom: 12px;
            border-radius: 2px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ── Generation progress bar ── */
        .generate-progress {
            display: none;
            flex-direction: column;
            gap: 8px;
            padding: 16px 28px;
            background: #fafafa;
            border-top: 1px solid #e5e5e7;
        }

        .gp-bar-track {
            height: 4px;
            background: #e5e5e7;
            width: 100%;
        }

        .gp-bar-fill {
            height: 100%;
            background: #313437;
            width: 0%;
            transition: width 0.18s ease;
        }

        .gp-status {
            font-size: 12px;
            color: #6e6e73;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>VerityRI Powered AI Insights</h1>
            <p class="subtitle">Vista Group</p>
        </div>
    </header>

    <div class="container">
        <!-- Configuration Card - Expanded State -->
        <div class="card" id="configCard">
            <div class="config-header" onclick="toggleConfig()">
                <div class="config-title">
                    <h2>Data Configuration</h2>
                    <p>Select the range of data you want to generate insights for</p>
                </div>
                <div style="display: flex; align-items: center; gap: 24px;">
                    <div class="config-summary" id="configSummary" style="display: none;">
                        <div class="config-summary-item">
                            <span>Surveys:</span>
                            <strong id="surveyCount">2</strong>
                        </div>
                        <div class="config-summary-item">
                            <span>Hierarchy items:</span>
                            <strong id="orgCount">All</strong>
                        </div>
                        <div class="config-summary-item">
                            <span>Accounts:</span>
                            <strong id="accountCount">46</strong>
                        </div>
                    </div>
                    <div class="toggle-icon expanded" id="toggleIcon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="config-content" id="configContent">
                <!-- Survey Range -->
                <div class="selector-group">
                    <div class="selector-label">
                        <span>Survey Range</span>
                        <button class="select-all-btn" onclick="toggleSelectAll(this, 'survey')">Select All</button>
                    </div>
                    <input type="text" class="search-box" placeholder="Search surveys...">
                    <div class="selector-box">
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Q1 2026</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Q4 2025</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox">
                            <span>Q3 2025</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox">
                            <span>Q2 2025</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox">
                            <span>Q3 2024</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox">
                            <span>Q1 2024</span>
                        </label>
                    </div>
                </div>

                <!-- Hierarchy and Markets -->
                <div class="selector-group">
                    <div class="selector-label">
                        <span>Hierarchy and Markets</span>
                        <button class="select-all-btn" onclick="toggleSelectAll(this, 'org')">Deselect All</button>
                    </div>
                    <input type="text" class="search-box" placeholder="Search hierarchy...">
                    <div class="selector-box">
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow expanded">▶</span>
                            <span>Vista Group</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow">▶</span>
                            <span>Mosaic Creative</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow">▶</span>
                            <span>Vector Tech</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow expanded">▶</span>
                            <span>Vista Creative</span>
                        </label>
                        <label class="selector-item grandchild">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Vista Creative Brazil</span>
                        </label>
                        <label class="selector-item grandchild">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Vista Creative China</span>
                        </label>
                        <label class="selector-item grandchild">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Vista Creative Ghana</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow">▶</span>
                            <span>Canvas + Co</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow">▶</span>
                            <span>Vista Digital</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow">▶</span>
                            <span>Vista Media</span>
                        </label>
                    </div>
                </div>

                <!-- Accounts -->
                <div class="selector-group">
                    <div class="selector-label">
                        <span>Accounts</span>
                        <button class="select-all-btn" onclick="toggleSelectAll(this, 'account')">Deselect All</button>
                    </div>
                    <input type="text" class="search-box" placeholder="Search accounts...">
                    <div class="selector-box">
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Account</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Account</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Adidas</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow expanded">▶</span>
                            <span>Apple</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Apple Pay</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Apple Gift Card</span>
                        </label>
                        <label class="selector-item child">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Apple Newsroom</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Asos</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span class="expand-arrow">▶</span>
                            <span>Account</span>
                        </label>
                        <label class="selector-item parent">
                            <input type="checkbox" class="checkbox" checked>
                            <span>Account</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="action-bar" id="actionBar">
                <div></div>
                <button class="btn btn-primary" onclick="applyConfiguration()">
                    GENERATE INSIGHTS
                </button>
            </div>
        </div>

        <!-- Generate Section -->
        <div class="card">
            <div class="generate-section">
                <div class="generate-tabs">
                    <button class="tab active" onclick="switchTab('executive', this)">Executive Summary</button>
                    <button class="tab" onclick="switchTab('action', this)">Action Planning</button>
                    <button class="tab" onclick="switchTab('chats', this)">Chat</button>
                </div>
            </div>

            <!-- ── TAB: Executive Summary ── -->
            <div id="tab-executive" class="tab-panel">

            <!-- Executive Summary Content -->
            <div class="summary-content">
                <div class="summary-header">
                    <h3>Executive Summary</h3>
                    <button class="btn-download">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        DOWNLOAD PDF
                    </button>
                </div>
            </div>

            <!-- Data Summary -->
            <div class="data-summary" id="dataSummary">
                <div><strong>Generated:</strong> 05 Feb 2026 17:12 GMT</div>
                <div><strong>Data Reach:</strong> Surveys: Q4 2025, Q1 2026 | Hierarchy items: All | Accounts: 46</div>
            </div>

            <!-- Summary Results -->
            <div id="summaryResults">
                <div class="exec-sections">

                    <!-- Section 1: Key Metrics -->
                    <div class="exec-section">
                        <div class="exec-section-label">
                            <span class="exec-section-dot dot-metrics"></span>
                            <span class="label-metrics">Key Metrics of Significance</span>
                        </div>
                        <div class="exec-section-body">
                            <p>The overall relationship is stable and slightly improving, with the Q4 2025 rating of 8.19 (91 responses, 78% response rate) edging up +0.86 points from the prior quarter's 7.33 rating (73 responses, 61% response rate). This places us above the Creative industry benchmark of 8.04 and well‑above the sector‑wide response‑rate norm of 55.3%.</p>
                            <p>Distribution of sentiment aligns with industry expectations – Active Advocates (9–10) make up 41% of respondents, Passive Advocates (8) 29%, while Active Detractors (1–4) are only 3%, matching the normative detractor floor.</p>
                        </div>
                        <div class="exec-section-footer">
                            <button class="chat-inline-btn" onclick="openChat('Key Metrics of Significance')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                ASK ABOUT THIS
                            </button>
                        </div>
                    </div>

                    <!-- Section 2: Areas of Risk -->
                    <div class="exec-section">
                        <div class="exec-section-label">
                            <span class="exec-section-dot dot-risk"></span>
                            <span class="label-risk">Areas of Risk and Vulnerability</span>
                        </div>
                        <div class="exec-section-body">
                            <p>Missing voices amplify hidden friction: the largest silent segment (39.7% of the pool) showed a 21.7% non‑response rate, leaving two critical contacts unheard; their absence truncates insight from a high‑impact group.</p>
                            <p>Silent detractors raise a red flag – 15 participants (including 7 critical contacts) dropped out after previously rating low; this hidden detractor volume exceeds the industry norm of 3% active and 9% passive detractors.</p>
                            <p>SAPMENA ZONE (10 responses, 16.7% non‑response) reported a 6.4 rating, citing weak strategy, poor efficiency, and delivery errors.</p>
                        </div>
                        <div class="exec-section-footer">
                            <button class="chat-inline-btn" onclick="openChat('Areas of Risk and Vulnerability')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                ASK ABOUT THIS
                            </button>
                        </div>
                    </div>

                    <!-- Section 3: What's Changed -->
                    <div class="exec-section">
                        <div class="exec-section-label">
                            <span class="exec-section-dot dot-changed"></span>
                            <span class="label-changed">What's Changed Since Last Round</span>
                        </div>
                        <div class="exec-section-body">
                            <p>Score momentum: the aggregate rating climbed +0.86 points driven primarily by higher engagement from the main cohort (response rate up from 61% to 78%); the underlying sentiment remains anchored near 8.0, indicating stability rather than volatility.</p>
                            <p>Leadership alignment: Critical‑contact performance shows an improving momentum flag (overall CC avg 8.36, 85% response), outpacing the baseline response rate of 78% and suggesting that senior voices are increasingly positive.</p>
                        </div>
                        <div class="exec-section-footer">
                            <button class="chat-inline-btn" onclick="openChat('What\'s Changed Since Last Round')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                ASK ABOUT THIS
                            </button>
                        </div>
                    </div>

                    <!-- Section 4: Celebration & Opportunity -->
                    <div class="exec-section">
                        <div class="exec-section-label">
                            <span class="exec-section-dot dot-celebrate"></span>
                            <span class="label-celebrate">Areas of Celebration and Opportunity</span>
                        </div>
                        <div class="exec-section-body">
                            <p>High‑volume, high‑score anchors: the core cohort delivered an 8.31 rating with strong participation, while Iberia (9.17), Benelux (9.0), Germany (8.5), and Greece (9.75) all exceed the global average, providing reliable advocates.</p>
                            <p>Thematic wins: Advocates repeatedly praised timeliness (19 mentions), creative work (17), talent (14), and agility (12), confirming speed, quality, and skilled delivery as the pillars of success.</p>
                            <p>Strategic leverage: deploy the Benelux Critical Contact (10 rating) and Iberia team (9.25 CC rating) as internal champions to mentor lower‑scoring groups.</p>
                        </div>
                        <div class="exec-section-footer">
                            <button class="chat-inline-btn" onclick="openChat('Areas of Celebration and Opportunity')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                ASK ABOUT THIS
                            </button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Initial Empty State -->
            <div class="summary-content" id="emptyState" style="display: none;">
                <div class="empty-state">
                    <div class="empty-state-icon">📊</div>
                    <h4>Ready to Generate Insights</h4>
                    <p>Configure your data selection above and click "GENERATE INSIGHTS" to create your executive summary</p>
                </div>
            </div>

            <!-- Deeper Findings -->
            <div class="deeper-findings">
                <h3>Deeper Findings</h3>
                <p>Deep dive into the detail by looking into the 10 categories we evaluate to generate the executive summary</p>
                
                <div class="findings-grid">
                    <!-- Category 1 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 1</div>
                                <div class="category-name">Performance Trend</div>
                                <div class="category-subtitle">How satisfaction and response rates are changing over time vs the norm.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Performance Trend')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat1')">
                                    SHOW GRAPHIC
                                </button>
                            </div>
                        </div>
                        <div class="category-content" id="cat1-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Performance trend analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat1-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 2 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 2</div>
                                <div class="category-name">Key Drivers</div>
                                <div class="category-subtitle">Identifies which factors have the greatest impact on ratings.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Key Drivers')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat2')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat2-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Key drivers analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat2-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 3 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 3</div>
                                <div class="category-name">Deep Dive Analysis</div>
                                <div class="category-subtitle">Compares satisfaction and participation across markets and regions.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Deep Dive Analysis')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat3')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat3-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Deep dive analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat3-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 4 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 4</div>
                                <div class="category-name">Who Didn't Respond</div>
                                <div class="category-subtitle">Highlights key contacts and markets that are non-responders</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Who Didn't Respond')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat4')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat4-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Non-responder analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat4-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 5 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 5</div>
                                <div class="category-name">Silent Detractor Risk</div>
                                <div class="category-subtitle">Identifies potential hidden dissatisfaction that could affect overall results.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Silent Detractor Risk')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat5')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat5-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Silent detractor risk analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat5-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 6 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 6</div>
                                <div class="category-name">Critical Contact Health</div>
                                <div class="category-subtitle">Evaluates satisfaction and response levels among high-impact stakeholders.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Critical Contact Health')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat6')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat6-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Critical contact health analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat6-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 7 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 7</div>
                                <div class="category-name">Feedback Themes</div>
                                <div class="category-subtitle">Summarises recurring positive feedback and areas needing improvement.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Feedback Themes')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat7')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat7-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Feedback themes analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat7-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 8 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 8</div>
                                <div class="category-name">Partnership & Vision</div>
                                <div class="category-subtitle">Shows whether feedback reflects relational support or strategic partnership.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Partnership &amp; Vision')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat8')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat8-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Partnership & vision analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat8-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 9 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 9</div>
                                <div class="category-name">Focus Areas & Opportunities</div>
                                <div class="category-subtitle">Highlights markets needing improvement and where strong practices can be shared.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Focus Areas &amp; Opportunities')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat9')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat9-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Focus areas & opportunities analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat9-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 10 -->
                    <div class="category-wrapper">
                        <div class="category-header">
                            <div class="category-info">
                                <div class="category-number">CATEGORY 10</div>
                                <div class="category-name">Confidence in the Data</div>
                                <div class="category-subtitle">Indicates how reliable rating differences are based on statistical evidence.</div>
                            </div>
                            <div class="category-toggle">
                                <button class="category-chat-btn" onclick="openChat('Confidence in the Data')">
                                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    ASK ABOUT THIS
                                </button>
                                <button class="show-graphic" onclick="toggleGraphic('cat10')">
                                    SHOW GRAPHIC
                                </button>
                                
                            </div>
                        </div>
                        <div class="category-content" id="cat10-content">
                            <div style="padding: 20px; background: #fafafa; min-height: 100px; color: #6e6e73;">
                                Confidence in the data analysis will appear here after generating insights
                            </div>
                            <div class="graphic-expanded" id="cat10-graphic" style="display: none;">
                                <div class="graphic-placeholder">
                                    📊 Interactive Dashboard Widget (Chart/Graph visualization)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            </div><!-- /tab-executive -->

            <!-- ── TAB: Action Planning ── -->
            <div id="tab-action" class="tab-panel" style="display:none;">
                <div class="summary-content">
                    <div class="summary-header">
                        <h3>Action Planning</h3>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">📋</div>
                        <h4>Action Planning Coming Soon</h4>
                        <p>AI-generated action plans based on your insights will appear here</p>
                    </div>
                </div>
            </div><!-- /tab-action -->

            <!-- ── TAB: Past Chats ── -->
            <div id="tab-chats" class="tab-panel" style="display:none;">
                <div class="past-chats-layout">

                    <!-- Sidebar: list of sessions -->
                    <div class="past-chats-sidebar">
                        <div class="past-chats-sidebar-header">
                            <span class="past-chats-sidebar-title">CONVERSATIONS</span>
                            <span class="past-chats-count" id="chatCount">6</span>
                        </div>
                        <div class="past-chats-search-wrap">
                            <svg class="past-chats-search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            <input class="past-chats-search" id="chatSearch" placeholder="Search conversations…" oninput="filterChats(this.value)">
                        </div>
                        <div class="past-chats-list" id="chatList">

                            <div class="chat-session active" onclick="openSession(this, 0)">
                                <div class="session-context-tag">Areas of Risk and Vulnerability</div>
                                <div class="session-preview">Silent detractors raise a red flag — 15 participants…</div>
                                <div class="session-meta">
                                    <span class="session-date">05 Feb 2026</span>
                                    <span class="session-msg-count">4 messages</span>
                                </div>
                            </div>

                            <div class="chat-session" onclick="openSession(this, 1)">
                                <div class="session-context-tag">Performance Trend</div>
                                <div class="session-preview">Can you compare this to the industry benchmark in more detail?</div>
                                <div class="session-meta">
                                    <span class="session-date">05 Feb 2026</span>
                                    <span class="session-msg-count">7 messages</span>
                                </div>
                            </div>

                            <div class="chat-session" onclick="openSession(this, 2)">
                                <div class="session-context-tag">Key Metrics of Significance</div>
                                <div class="session-preview">What does the 78% response rate mean for confidence in the data?</div>
                                <div class="session-meta">
                                    <span class="session-date">04 Feb 2026</span>
                                    <span class="session-msg-count">3 messages</span>
                                </div>
                            </div>

                            <div class="chat-session" onclick="openSession(this, 3)">
                                <div class="session-context-tag">Silent Detractor Risk</div>
                                <div class="session-preview">Which accounts are most at risk of churning this quarter?</div>
                                <div class="session-meta">
                                    <span class="session-date">03 Feb 2026</span>
                                    <span class="session-msg-count">9 messages</span>
                                </div>
                            </div>

                            <div class="chat-session" onclick="openSession(this, 4)">
                                <div class="session-context-tag">Areas of Celebration and Opportunity</div>
                                <div class="session-preview">How can we use Iberia as an internal champion?</div>
                                <div class="session-meta">
                                    <span class="session-date">02 Feb 2026</span>
                                    <span class="session-msg-count">5 messages</span>
                                </div>
                            </div>

                            <div class="chat-session" onclick="openSession(this, 5)">
                                <div class="session-context-tag">Critical Contact Health</div>
                                <div class="session-preview">Can you list all critical contacts who haven't responded?</div>
                                <div class="session-meta">
                                    <span class="session-date">28 Jan 2026</span>
                                    <span class="session-msg-count">6 messages</span>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Main: conversation detail -->
                    <div class="past-chats-main" id="sessionDetail">
                        <!-- Filled by JS -->
                    </div>

                </div>
            </div><!-- /tab-chats -->

        </div><!-- /card -->
        <div class="back-to-top">
            <button class="back-to-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"></polyline>
                </svg>
                BACK TO TOP
            </button>
        </div>
    </div>

    <script>
        function switchTab(tabId, btn) {
            // Hide all panels
            document.querySelectorAll('.tab-panel').forEach(p => p.style.display = 'none');
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            // Show selected
            document.getElementById('tab-' + tabId).style.display = '';
            btn.classList.add('active');
            // Load first session when switching to chats
            if (tabId === 'chats') {
                const first = document.querySelector('.chat-session');
                if (first) openSession(first, 0);
            }
        }

        // ── Session data ────────────────────────────────────────
        const sessions = [
            {
                context: 'Areas of Risk and Vulnerability',
                date: '05 Feb 2026, 17:34 GMT',
                messages: [
                    { role:'ai',   text: "You're asking about Areas of Risk. The most pressing concern is the silent detractor volume — 15 participants who previously rated low have not responded this round. Would you like me to identify which accounts are most at risk?" },
                    { role:'user', text: "Yes, which accounts are most at risk of churning?" },
                    { role:'ai',   text: "Based on the current data, the highest-risk accounts are those in the SAPMENA ZONE cluster. They recorded a 6.4 rating with a 16.7% non-response rate, and include critical contact Emily Rutherford whose last response cited 'incorrect reporting' and 'retainer not fit for business purpose.' The Nordics and Italy teams also show elevated non-response flags worth monitoring." },
                    { role:'user', text: "What actions should we take for SAPMENA?" },
                ]
            },
            {
                context: 'Performance Trend',
                date: '05 Feb 2026, 15:10 GMT',
                messages: [
                    { role:'ai',   text: "You're asking about the Performance Trend category. The Q4 2025 aggregate rating of 8.19 sits above the Creative industry benchmark of 8.04, with momentum driven mostly by improved response participation. What would you like to explore?" },
                    { role:'user', text: "Can you compare this to the industry benchmark in more detail?" },
                    { role:'ai',   text: "Certainly. The Creative industry benchmark is 8.04 with a typical response rate norm of 55.3%. Vista Group's Q4 2025 result of 8.19 beats the benchmark by 0.15 points, and the 78% response rate is 22.7 percentage points above the norm — a statistically significant participation advantage that lends greater confidence to the aggregate score." },
                    { role:'user', text: "Is 0.15 above benchmark considered strong?" },
                    { role:'ai',   text: "In relation surveys, a margin of 0.10–0.25 above benchmark is considered a solid but not exceptional outperformance. It indicates a healthy relationship without complacency. What differentiates Vista Group's position is the response rate advantage — high participation reduces measurement error and makes the score more defensible in client conversations." },
                    { role:'user', text: "How has our benchmark position changed since Q3?" },
                    { role:'ai',   text: "In Q3 2025 the aggregate was 7.33, which sat 0.71 points below the 8.04 benchmark — a meaningful underperformance. The jump to 8.19 in Q4 represents a swing of +0.86 points, moving from below-benchmark to above-benchmark in a single round. This is a significant positive shift, though it's important to note that some of this gain is attributable to improved participation rather than a fundamental change in client sentiment." },
                ]
            },
            {
                context: 'Key Metrics of Significance',
                date: '04 Feb 2026, 11:22 GMT',
                messages: [
                    { role:'ai',   text: "You're asking about Key Metrics. The Q4 2025 rating of 8.19 with a 78% response rate places Vista Group above the Creative benchmark of 8.04. What would you like to know more about?" },
                    { role:'user', text: "What does the 78% response rate mean for confidence in the data?" },
                    { role:'ai',   text: "A 78% response rate is well above the sector norm of 55.3%, which has a meaningful impact on data reliability. Higher participation reduces the influence of any single outlier response and narrows the margin of error. In practical terms, the aggregate rating of 8.19 carries a higher confidence interval than if only 55% had responded — meaning you can present these results to leadership with greater certainty that they reflect the actual client sentiment rather than a sampling artefact." },
                ]
            },
            {
                context: 'Silent Detractor Risk',
                date: '03 Feb 2026, 09:45 GMT',
                messages: [
                    { role:'ai',   text: "You're asking about Silent Detractor Risk. 15 participants, including 7 critical contacts, dropped out after previously rating low. This exceeds the industry norm and signals untapped dissatisfaction. Shall I identify the accounts?" },
                    { role:'user', text: "Which accounts are most at risk of churning this quarter?" },
                    { role:'ai',   text: "The accounts with the highest silent detractor risk are concentrated in SAPMENA ZONE and the Nordics Team. Both show a combination of below-average ratings in prior rounds and elevated non-response in the current round — the classic silent detractor pattern. Additionally, the Italy Team is missing two critical contacts entirely, which represents a blind spot." },
                    { role:'user', text: "Can you give me a risk score for each?" },
                    { role:'ai',   text: "Using a composite of prior rating, non-response rate, and critical contact coverage, here are the relative risk levels: SAPMENA ZONE — High Risk (6.4 prior rating, 16.7% non-response, 1 critical detractor on record). Nordics — Medium-High Risk (7.25 prior rating, 33.3% non-response). Italy — Medium Risk (no prior detractor flags but 40% non-response with 2 critical contacts missing). Europe/Global — Low-Medium Risk (7.33 rating, 0% non-response but small sample of 3 responses)." },
                    { role:'user', text: "What's the recommended next step for SAPMENA?" },
                    { role:'ai',   text: "The recommended next step for SAPMENA ZONE is a direct engagement call with the account lead within 2 weeks, specifically referencing Emily Rutherford's feedback around reporting accuracy and strategic alignment. This should be framed as a proactive check-in rather than a response to the survey. In parallel, a root cause review of the reporting and retainer structure she cited would address the structural issues before they escalate." },
                    { role:'user', text: "Draft a talking points brief for that call" },
                    { role:'ai',   text: "Here's a draft talking points brief for the SAPMENA engagement call:\n\n**Opening:** Acknowledge the strength of the overall relationship and thank the team for their participation.\n\n**Specific topic 1 — Reporting:** 'We've taken on board feedback about reporting accuracy. We've reviewed our processes and want to walk you through the changes we've made.'\n\n**Specific topic 2 — Strategic alignment:** 'We want to make sure our retainer structure is genuinely fit for your current business objectives. Can you help us understand how your priorities have shifted?'\n\n**Closing:** Agree on a 30-day follow-up to review changes and set expectations for next round." },
                    { role:'user', text: "Great, can you save this as an action item?" },
                ]
            },
            {
                context: 'Areas of Celebration and Opportunity',
                date: '02 Feb 2026, 14:05 GMT',
                messages: [
                    { role:'ai',   text: "You're asking about the celebration areas. Iberia and Benelux are standout performers — both above 9.0 with strong response rates. Shall I suggest how to leverage them as internal champions?" },
                    { role:'user', text: "How can we use Iberia as an internal champion?" },
                    { role:'ai',   text: "Iberia's 9.17 average with 75% response rate — and a Critical Contact rating of 9.25 — makes it one of the strongest relationship clusters in the portfolio. To use Iberia as an internal champion, consider: (1) Facilitating a peer knowledge-share session where the Iberia account team presents their relationship management approach to the SAPMENA and Nordics teams. (2) Using Iberia's CC as a reference contact for prospective clients in similar sectors. (3) Documenting the specific service practices that generated the high scores — timeliness and creative quality were the most cited themes — and codifying them as team standards." },
                    { role:'user', text: "What about Benelux?" },
                    { role:'ai',   text: "Benelux is equally compelling — a 9.0 rating with a 10-rated Critical Contact, which is the highest CC score in the entire dataset. The Benelux CC could serve as a case study or co-presenter in a client advisory board context. Given the 71% response rate, there's also room to deepen participation, which could further validate the score." },
                    { role:'user', text: "Can you draft a one-pager summary of these two accounts for the leadership deck?" },
                    { role:'ai',   text: "Absolutely. Here's a draft one-pager summary:\n\n**Champion Accounts: Iberia & Benelux — Q4 2025**\n\nBoth markets demonstrate what exceptional client partnership looks like in practice — high satisfaction, strong engagement, and vocal advocacy.\n\n**Iberia:** Rating 9.17 | 75% Response Rate | CC Rating 9.25. Advocates cited timeliness, creative quality, and team agility as the primary drivers. Recommended action: deploy as a mentoring resource for lower-scoring markets.\n\n**Benelux:** Rating 9.0 | 71% Response Rate | CC Rating 10.0. Highest Critical Contact score in the portfolio. Recommended action: engage CC as a reference contact and consider for client advisory board representation." },
                ]
            },
            {
                context: 'Critical Contact Health',
                date: '28 Jan 2026, 16:50 GMT',
                messages: [
                    { role:'ai',   text: "You're asking about Critical Contact Health. The overall CC average is 8.36 with an 85% response rate, outpacing the baseline. Would you like a breakdown by market?" },
                    { role:'user', text: "Can you list all critical contacts who haven't responded?" },
                    { role:'ai',   text: "Based on the current round's data, the following critical contacts are recorded as non-respondents: Simon Preuss (L'Oréal, SAPMENA ZONE cluster), Tanguy Delabrouhe (L'Oréal, SAPMENA ZONE cluster), and two unnamed critical contacts within the Italy Team cohort. Together these four represent a significant gap in high-impact stakeholder coverage." },
                    { role:'user', text: "What's the best approach to re-engage Simon Preuss?" },
                    { role:'ai',   text: "Re-engaging Simon Preuss should be handled carefully given his previous non-response. A direct, personalised outreach from a senior member of your team — ideally the account director — is more effective than a follow-up survey nudge. The message should acknowledge his time, reference a specific recent piece of work or milestone, and frame the feedback request as a genuine input into how the team prioritises its efforts. Avoid sending a generic survey reminder link." },
                    { role:'user', text: "Can you draft that outreach message?" },
                    { role:'ai',   text: "Here's a draft outreach message for Simon Preuss:\n\n---\n\nSubject: A quick word — your perspective matters\n\nHi Simon,\n\nI hope you're well. I wanted to reach out personally, separate from our usual project conversations.\n\nWe run a short feedback process each quarter to make sure we're genuinely delivering value — not just completing tasks. Your view on how we're performing is one I'd find particularly valuable, especially given the scope of work we've been running together.\n\nIt takes less than five minutes and your candid input directly shapes how we allocate resource and prioritise your account.\n\n[Survey link]\n\nThanks for your time — and for the partnership.\n\nBest,\n[Name]" },
                    { role:'user', text: "Perfect — flag this as a priority action" },
                    { role:'ai',   text: "Noted. I've flagged 'Re-engage Simon Preuss — personalised outreach' as a priority action. Would you like me to add Tanguy Delabrouhe and the Italy critical contacts to the action list as well?" },
                ]
            }
        ];

        function openSession(el, idx) {
            document.querySelectorAll('.chat-session').forEach(s => s.classList.remove('active'));
            el.classList.add('active');
            const s = sessions[idx];
            const detail = document.getElementById('sessionDetail');
            detail.innerHTML = `
                <div class="session-detail-header">
                    <div>
                        <div class="session-detail-title">${s.context}</div>
                        <div class="session-detail-meta">${s.date} &nbsp;·&nbsp; ${s.messages.length} messages</div>
                    </div>
                    <div class="session-detail-actions">
                        <button class="session-action-btn">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            EXPORT
                        </button>
                    </div>
                </div>
                <div class="session-messages">
                    ${s.messages.map(m => `
                        <div class="session-msg ${m.role}">
                            <div class="session-msg-label">${m.role === 'ai' ? 'VERITY AI' : 'YOU'}</div>
                            <div class="session-msg-bubble">${m.text.replace(/\n/g, '<br>')}</div>
                        </div>`).join('')}
                </div>
                <div class="session-continue-bar">
                    <button class="session-continue-btn" onclick="continueSession(${idx})">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        CONTINUE THIS CONVERSATION
                    </button>
                </div>`;
        }

        function continueSession(idx) {
            openChat(sessions[idx].context);
        }

        function filterChats(query) {
            const q = query.toLowerCase();
            const sessions = document.querySelectorAll('.chat-session');
            let visible = 0;
            sessions.forEach(s => {
                const text = s.textContent.toLowerCase();
                const show = !q || text.includes(q);
                s.style.display = show ? '' : 'none';
                if (show) visible++;
            });
            document.getElementById('chatCount').textContent = visible;
        }

        // ── Category content data ────────────────────────────────
        const categoryContent = {
            'cat1': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>Vista Group's satisfaction trajectory has moved from <strong>below benchmark to above benchmark</strong> in a single round — a meaningful shift driven by a 17 percentage-point improvement in response participation. The Q4 2025 aggregate of 8.19 now sits 0.15 points above the Creative industry norm of 8.04.</p>
                        <p>Importantly, the underlying sentiment has remained anchored near 8.0 across both periods, suggesting the improvement reflects better audience coverage rather than a fundamental change in client perception. This stability is a positive indicator of relationship health.</p>
                        <p>Response rate at 78% is <strong>22.7 percentage points above</strong> the sector norm of 55.3% — lending significantly greater statistical confidence to the aggregate figure.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value neutral">8.19</div><div class="cat-metric-label">Q4 2025 Rating</div><div class="cat-metric-delta delta-up">▲ +0.86 vs Q3</div></div>
                    <div class="cat-metric"><div class="cat-metric-value neutral">7.33</div><div class="cat-metric-label">Q3 2025 Rating</div><div class="cat-metric-delta delta-down">▼ −0.71 vs benchmark</div></div>
                    <div class="cat-metric"><div class="cat-metric-value">8.04</div><div class="cat-metric-label">Industry Benchmark</div><div class="cat-metric-delta delta-flat">Creative sector norm</div></div>
                    <div class="cat-metric"><div class="cat-metric-value positive">78%</div><div class="cat-metric-label">Response Rate</div><div class="cat-metric-delta delta-up">▲ +17pp vs Q3</div></div>
                </div>
                <table class="cat-table">
                    <thead><tr><th>Round</th><th>Rating</th><th>Responses</th><th>Response Rate</th><th>vs Benchmark</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Q4 2025</strong></td><td><span class="status-pill pill-good">8.19</span></td><td>91</td><td>78%</td><td class="delta-up">+0.15</td></tr>
                        <tr><td>Q3 2025</td><td><span class="status-pill pill-risk">7.33</span></td><td>73</td><td>61%</td><td class="delta-down">−0.71</td></tr>
                        <tr><td>Q2 2025</td><td><span class="status-pill pill-warn">7.98</span></td><td>68</td><td>57%</td><td class="delta-flat">−0.06</td></tr>
                        <tr><td>Q1 2024</td><td><span class="status-pill pill-good">8.21</span></td><td>82</td><td>72%</td><td class="delta-up">+0.17</td></tr>
                    </tbody>
                </table>`
            },

            'cat2': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>The <strong>team_name dimension</strong> is the single most powerful lever in the data, accounting for 42% of total rating variance (eta-squared = 0.42) — far exceeding any other factor measured. This confirms that which team a client works with matters more to their satisfaction than account size, market, or tenure.</p>
                        <p>The widest intra-team gap in the dataset is <strong>3.35 rating points</strong>, creating a situation where two clients at the same agency can have dramatically different experiences depending solely on team allocation.</p>
                        <p><strong>Implication:</strong> Performance management efforts should be primarily directed at team-level coaching and standardisation rather than account-level interventions. The data strongly suggests that levelling up the lowest-performing teams would have a disproportionate impact on the overall score.</p>
                    </div>
                </div>`,
                graphic: `<div class="progress-row"><div class="progress-label">Team Assignment</div><div class="progress-track"><div class="progress-fill good" style="width:84%"></div></div><div class="progress-value">42%</div></div>
                <div class="progress-row"><div class="progress-label">Delivery Timeliness</div><div class="progress-track"><div class="progress-fill good" style="width:54%"></div></div><div class="progress-value">27%</div></div>
                <div class="progress-row"><div class="progress-label">Strategic Alignment</div><div class="progress-track"><div class="progress-fill warn" style="width:40%"></div></div><div class="progress-value">20%</div></div>
                <div class="progress-row"><div class="progress-label">Communication Quality</div><div class="progress-track"><div class="progress-fill warn" style="width:30%"></div></div><div class="progress-value">15%</div></div>
                <div class="progress-row"><div class="progress-label">Creative Output</div><div class="progress-track"><div class="progress-fill" style="width:22%"></div></div><div class="progress-value">11%</div></div>
                <div class="progress-row"><div class="progress-label">Reporting Accuracy</div><div class="progress-track"><div class="progress-fill risk" style="width:16%"></div></div><div class="progress-value">8%</div></div>`
            },

            'cat3': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>Market-level performance shows a <strong>3.35-point spread</strong> between the highest-scoring market (Greece, 9.75) and the lowest (SAPMENA ZONE, 6.40). This dispersion is significant and points to varying levels of relationship maturity and service delivery quality across regions.</p>
                        <p>Four markets exceed the global average of 8.19: Greece (9.75), Iberia (9.17), Benelux (9.0), and Germany (8.5). These represent <strong>57 responses</strong> — over 60% of the total dataset — creating a strong foundation of positive sentiment.</p>
                        <p>Three markets fall below average and require targeted intervention: SAPMENA ZONE (6.4, high risk), Nordics (7.25, elevated non-response), and Europe/Global (7.33, small sample). The Italy market data is incomplete due to missing critical contacts.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value positive">9.75</div><div class="cat-metric-label">Highest Market</div><div class="cat-metric-delta delta-flat">Greece</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">6.40</div><div class="cat-metric-label">Lowest Market</div><div class="cat-metric-delta delta-flat">SAPMENA</div></div>
                    <div class="cat-metric"><div class="cat-metric-value">3.35</div><div class="cat-metric-label">Score Range</div><div class="cat-metric-delta delta-flat">Max spread</div></div>
                    <div class="cat-metric"><div class="cat-metric-value neutral">8</div><div class="cat-metric-label">Markets Tracked</div><div class="cat-metric-delta delta-flat">This round</div></div>
                </div>
                <table class="cat-table">
                    <thead><tr><th>Market / Team</th><th>Rating</th><th>Responses</th><th>Non-Response</th><th>Status</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Greece</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill good" style="width:97.5%"></div></div>9.75</div></td><td>8</td><td>0%</td><td><span class="status-pill pill-good">STRONG</span></td></tr>
                        <tr><td><strong>Iberia</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill good" style="width:91.7%"></div></div>9.17</div></td><td>12</td><td>25%</td><td><span class="status-pill pill-good">STRONG</span></td></tr>
                        <tr><td><strong>Benelux</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill good" style="width:90%"></div></div>9.00</div></td><td>14</td><td>29%</td><td><span class="status-pill pill-good">STRONG</span></td></tr>
                        <tr><td><strong>Germany</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill good" style="width:85%"></div></div>8.50</div></td><td>22</td><td>14%</td><td><span class="status-pill pill-good">ABOVE AVG</span></td></tr>
                        <tr><td><strong>Core Cohort</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill good" style="width:83.1%"></div></div>8.31</div></td><td>36</td><td>21.7%</td><td><span class="status-pill pill-neutral">AVERAGE</span></td></tr>
                        <tr><td><strong>Europe / Global</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill warn" style="width:73.3%"></div></div>7.33</div></td><td>3</td><td>0%</td><td><span class="status-pill pill-warn">BELOW AVG</span></td></tr>
                        <tr><td><strong>Nordics</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill warn" style="width:72.5%"></div></div>7.25</div></td><td>4</td><td>33.3%</td><td><span class="status-pill pill-warn">AT RISK</span></td></tr>
                        <tr><td><strong>SAPMENA ZONE</strong></td><td><div class="score-bar-wrap"><div class="score-bar"><div class="score-bar-fill risk" style="width:64%"></div></div>6.40</div></td><td>10</td><td>16.7%</td><td><span class="status-pill pill-risk">HIGH RISK</span></td></tr>
                    </tbody>
                </table>`
            },

            'cat4': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>Non-response is not random — it clusters around accounts with prior dissatisfaction signals, suggesting the missing data is systematically skewed toward negative sentiment. This creates an <strong>optimism bias</strong> in the headline score.</p>
                        <p>Four <strong>critical contacts</strong> did not respond this round: Simon Preuss and Tanguy Delabrouhe (both L'Oréal SAPMENA, both with prior low ratings), plus two unnamed contacts in the Italy market. Their absence represents a significant gap in high-impact stakeholder coverage.</p>
                        <p><strong>Recommended action:</strong> Prioritise personalised outreach to Simon Preuss and Tanguy Delabrouhe from senior account leadership before the next survey round. Standard reminder nudges are unlikely to be effective given their prior disengagement pattern.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value negative">22%</div><div class="cat-metric-label">Overall Non-Response</div><div class="cat-metric-delta delta-down">▼ +5pp vs Q3</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">4</div><div class="cat-metric-label">Critical Contacts Silent</div><div class="cat-metric-delta delta-flat">High impact</div></div>
                    <div class="cat-metric"><div class="cat-metric-value warn">Italy</div><div class="cat-metric-label">Highest Risk Market</div><div class="cat-metric-delta delta-flat">40% non-response</div></div>
                </div>
                <table class="cat-table">
                    <thead><tr><th>Contact / Market</th><th>Role</th><th>Last Rating</th><th>Status</th><th>Risk</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Simon Preuss</strong></td><td>L'Oréal — SAPMENA</td><td>5.5 (Q3)</td><td><span class="status-pill pill-risk">NOT RESPONDED</span></td><td class="delta-down">High</td></tr>
                        <tr><td><strong>Tanguy Delabrouhe</strong></td><td>L'Oréal — SAPMENA</td><td>6.0 (Q3)</td><td><span class="status-pill pill-risk">NOT RESPONDED</span></td><td class="delta-down">High</td></tr>
                        <tr><td><strong>CC — Italy #1</strong></td><td>Italy Team</td><td>Unknown</td><td><span class="status-pill pill-warn">FIRST ABSENCE</span></td><td class="delta-down">Medium</td></tr>
                        <tr><td><strong>CC — Italy #2</strong></td><td>Italy Team</td><td>Unknown</td><td><span class="status-pill pill-warn">FIRST ABSENCE</span></td><td class="delta-down">Medium</td></tr>
                        <tr><td>Nordics Team (4 inv.)</td><td>Various</td><td>7.5 (Q3)</td><td><span class="status-pill pill-warn">33% NON-RESP.</span></td><td class="delta-flat">Medium</td></tr>
                    </tbody>
                </table>`
            },

            'cat5': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>The <strong>silent detractor pattern</strong> is the most concerning finding in this dataset. 15 participants who rated below 6.0 in the previous round chose not to respond in Q4 2025. This is a well-documented precursor to account churn — disengaged clients stop providing feedback before they stop the relationship.</p>
                        <p>With 7 critical contacts among the silent group, the potential revenue exposure is disproportionate to the raw number. Industry research suggests silent detractors convert to active churn at <strong>2.4× the rate</strong> of visible detractors, precisely because the warning signals go undetected.</p>
                        <p><strong>Risk model:</strong> If the 15 silent detractors were to rate at their prior average (approx. 5.2), the aggregate score would fall from 8.19 to approximately <strong>7.61</strong> — dropping below the industry benchmark. This illustrates the fragility of the headline figure without full participation.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value negative">15</div><div class="cat-metric-label">Silent Detractors</div><div class="cat-metric-delta delta-flat">Prev. low raters</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">7</div><div class="cat-metric-label">Critical Contacts</div><div class="cat-metric-delta delta-flat">Among silent group</div></div>
                    <div class="cat-metric"><div class="cat-metric-value">3%</div><div class="cat-metric-label">Active Detractor Norm</div><div class="cat-metric-delta delta-flat">Industry baseline</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">9%</div><div class="cat-metric-label">Passive Det. Norm</div><div class="cat-metric-delta delta-flat">Industry baseline</div></div>
                </div>
                <div class="progress-row"><div class="progress-label">Active Detractors (1–4)</div><div class="progress-track"><div class="progress-fill good" style="width:30%"></div></div><div class="progress-value">3%</div></div>
                <div class="progress-row"><div class="progress-label">Silent (est. risk)</div><div class="progress-track"><div class="progress-fill risk" style="width:100%"></div></div><div class="progress-value">16%</div></div>
                <div class="progress-row"><div class="progress-label">Industry Passive Norm</div><div class="progress-track"><div class="progress-fill warn" style="width:90%"></div></div><div class="progress-value">9%</div></div>`
            },

            'cat6': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>The critical contact cohort is performing <strong>ahead of the general population</strong> on both satisfaction (8.36 vs 8.19) and response rate (85% vs 78%). This is an encouraging signal — senior stakeholders are more engaged and more positive than the broader base, lending stability to the relationship at the executive layer.</p>
                        <p>However, two significant exceptions require immediate attention: Emily Rutherford's rating of 3.0 (SAPMENA ZONE) and the non-response from Simon Preuss and Tanguy Delabrouhe. These outliers represent concentrated risk within the critical contact segment.</p>
                        <p>The standout performers — Benelux CC (10.0) and Iberia CC (9.25) — can be leveraged as internal champions and reference contacts for prospective clients.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value positive">8.36</div><div class="cat-metric-label">CC Avg Rating</div><div class="cat-metric-delta delta-up">▲ +0.17 vs overall</div></div>
                    <div class="cat-metric"><div class="cat-metric-value positive">85%</div><div class="cat-metric-label">CC Response Rate</div><div class="cat-metric-delta delta-up">▲ +7pp vs baseline</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">4</div><div class="cat-metric-label">CCs Not Responded</div><div class="cat-metric-delta delta-flat">Requires action</div></div>
                    <div class="cat-metric"><div class="cat-metric-value positive">10.0</div><div class="cat-metric-label">Highest CC Score</div><div class="cat-metric-delta delta-flat">Benelux</div></div>
                </div>
                <table class="cat-table">
                    <thead><tr><th>Critical Contact</th><th>Market</th><th>Rating</th><th>Response</th><th>Momentum</th></tr></thead>
                    <tbody>
                        <tr><td><strong>CC — Benelux</strong></td><td>Benelux</td><td><span class="status-pill pill-good">10.0</span></td><td>✓ Responded</td><td class="delta-up">▲ Champion</td></tr>
                        <tr><td><strong>CC — Iberia</strong></td><td>Iberia</td><td><span class="status-pill pill-good">9.25</span></td><td>✓ Responded</td><td class="delta-up">▲ Champion</td></tr>
                        <tr><td><strong>CC — Germany</strong></td><td>Germany</td><td><span class="status-pill pill-good">8.75</span></td><td>✓ Responded</td><td class="delta-up">▲ Improving</td></tr>
                        <tr><td><strong>Emily Rutherford</strong></td><td>SAPMENA</td><td><span class="status-pill pill-risk">3.0</span></td><td>✓ Responded</td><td class="delta-down">▼ Detractor</td></tr>
                        <tr><td><strong>Simon Preuss</strong></td><td>L'Oréal SAPMENA</td><td>—</td><td><span class="status-pill pill-risk">Not Responded</span></td><td class="delta-down">▼ At Risk</td></tr>
                        <tr><td><strong>Tanguy Delabrouhe</strong></td><td>L'Oréal SAPMENA</td><td>—</td><td><span class="status-pill pill-risk">Not Responded</span></td><td class="delta-down">▼ At Risk</td></tr>
                    </tbody>
                </table>`
            },

            'cat7': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>Text analysis of open-ended responses (91 total) produced <strong>329 coded references</strong> across positive and improvement themes. The sentiment ratio is 255 positive to 74 improvement-focused — a 3.4:1 ratio, broadly in line with industry norms for high-performing accounts.</p>
                        <p>The most frequently praised attributes are <strong>timeliness</strong> (19 mentions), <strong>creative quality</strong> (17), and <strong>team talent</strong> (14) — confirming that speed, output quality, and skilled delivery are the pillars of client satisfaction.</p>
                        <p>The most frequently cited improvement areas are <strong>reporting accuracy</strong> (14 mentions), <strong>strategic depth</strong> (12), and <strong>communication clarity</strong> (10) — pointing to process and relationship maturity gaps rather than fundamental delivery failures.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value positive">255</div><div class="cat-metric-label">Positive References</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">74</div><div class="cat-metric-label">Improvement Refs</div></div>
                    <div class="cat-metric"><div class="cat-metric-value neutral">3.4:1</div><div class="cat-metric-label">Sentiment Ratio</div></div>
                </div>
                <div class="cat-insight"><strong>Most praised themes:</strong></div>
                <div class="tag-cloud">
                    <span class="theme-tag positive-tag">Timeliness <span class="tag-count">19</span></span>
                    <span class="theme-tag positive-tag">Creative quality <span class="tag-count">17</span></span>
                    <span class="theme-tag positive-tag">Team talent <span class="tag-count">14</span></span>
                    <span class="theme-tag positive-tag">Agility <span class="tag-count">12</span></span>
                    <span class="theme-tag positive-tag">Responsiveness <span class="tag-count">11</span></span>
                    <span class="theme-tag positive-tag">Proactive thinking <span class="tag-count">9</span></span>
                    <span class="theme-tag positive-tag">Collaboration <span class="tag-count">8</span></span>
                </div>
                <div class="cat-insight"><strong>Most cited improvement areas:</strong></div>
                <div class="tag-cloud">
                    <span class="theme-tag negative-tag">Reporting accuracy <span class="tag-count">14</span></span>
                    <span class="theme-tag negative-tag">Strategic depth <span class="tag-count">12</span></span>
                    <span class="theme-tag negative-tag">Communication clarity <span class="tag-count">10</span></span>
                    <span class="theme-tag negative-tag">Retainer fit <span class="tag-count">8</span></span>
                    <span class="theme-tag negative-tag">Senior involvement <span class="tag-count">6</span></span>
                </div>
                <hr class="divider">
                <div class="cat-insight"><p><em>"The team consistently delivers on time and the creative work has been outstanding this quarter."</em> — Iberia, 9.0 rating<br><em>"Limited insights provided. Incorrect reporting. Retainer not fit for business purpose."</em> — SAPMENA, Emily Rutherford, 3.0 rating</p></div>`
            },

            'cat8': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>The feedback distribution sits at a near-even split between relational (partnership, trust, shared vision) and transactional (delivery, process, output quality) themes. This is a <strong>healthy baseline</strong> — the relationship is not purely transactional — but there is meaningful room to deepen the strategic layer.</p>
                        <p>High-scoring markets (Iberia, Benelux, Germany) skew toward relational language — words like <em>partnership</em>, <em>trusted advisor</em>, and <em>shared goals</em> appear disproportionately in their feedback. Low-scoring markets (SAPMENA, Nordics) are almost exclusively transactional, citing <em>deliverables</em>, <em>reports</em>, and <em>retainer scope</em>.</p>
                        <p><strong>Strategic opportunity:</strong> Shifting SAPMENA from transactional to relational framing would require a proactive QBR agenda focused on business outcomes rather than campaign performance metrics.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value neutral">47.6%</div><div class="cat-metric-label">Relational Themes</div><div class="cat-metric-delta delta-flat">Partnership signals</div></div>
                    <div class="cat-metric"><div class="cat-metric-value neutral">51.5%</div><div class="cat-metric-label">Transactional Themes</div><div class="cat-metric-delta delta-flat">Task-level signals</div></div>
                    <div class="cat-metric"><div class="cat-metric-value">0.9%</div><div class="cat-metric-label">Other / Ambiguous</div></div>
                </div>
                <div class="progress-row"><div class="progress-label">Greece</div><div class="progress-track"><div class="progress-fill good" style="width:78%"></div></div><div class="progress-value">78% R</div></div>
                <div class="progress-row"><div class="progress-label">Iberia</div><div class="progress-track"><div class="progress-fill good" style="width:71%"></div></div><div class="progress-value">71% R</div></div>
                <div class="progress-row"><div class="progress-label">Benelux</div><div class="progress-track"><div class="progress-fill good" style="width:68%"></div></div><div class="progress-value">68% R</div></div>
                <div class="progress-row"><div class="progress-label">Nordics</div><div class="progress-track"><div class="progress-fill warn" style="width:31%"></div></div><div class="progress-value">31% R</div></div>
                <div class="progress-row"><div class="progress-label">SAPMENA ZONE</div><div class="progress-track"><div class="progress-fill risk" style="width:18%"></div></div><div class="progress-value">18% R</div></div>`
            },

            'cat9': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>Three markets require immediate focused attention based on below-average scores, elevated non-response, or missing critical contact coverage. Two markets represent scalable best-practice that can be shared across the portfolio through peer mentoring and internal case studies.</p>
                        <p><strong>SAPMENA ZONE</strong> (6.4 rating, 16.7% non-response) is the highest-priority intervention — requiring senior engagement, QBR agenda reset, and reporting accuracy review.</p>
                        <p><strong>Iberia and Benelux</strong> are the standout champions. Their high scores, strong participation, and positive critical contact relationships make them ideal candidates for internal mentoring roles and client reference contacts.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value negative">3</div><div class="cat-metric-label">Focus Markets</div><div class="cat-metric-delta delta-flat">Below avg or at risk</div></div>
                    <div class="cat-metric"><div class="cat-metric-value positive">2</div><div class="cat-metric-label">Champion Markets</div><div class="cat-metric-delta delta-flat">Mentor candidates</div></div>
                </div>
                <table class="cat-table">
                    <thead><tr><th>Market</th><th>Rating</th><th>Priority</th><th>Recommended Action</th></tr></thead>
                    <tbody>
                        <tr><td><strong>SAPMENA ZONE</strong></td><td><span class="status-pill pill-risk">6.40</span></td><td>🔴 Immediate</td><td>Senior engagement call; QBR agenda reset; reporting review</td></tr>
                        <tr><td><strong>Nordics</strong></td><td><span class="status-pill pill-warn">7.25</span></td><td>🟡 Near-term</td><td>Address non-response; check team capacity and alignment</td></tr>
                        <tr><td><strong>Italy</strong></td><td><span class="status-pill pill-warn">N/A</span></td><td>🟡 Near-term</td><td>Re-engage missing critical contacts before next round</td></tr>
                    </tbody>
                </table>
                <hr class="divider">
                <table class="cat-table">
                    <thead><tr><th>Champion Market</th><th>Rating</th><th>Why They Excel</th><th>Recommended Use</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Iberia</strong></td><td><span class="status-pill pill-good">9.17</span></td><td>Timeliness, creative quality, proactive comms</td><td>Peer mentoring; internal case study; CC as reference contact</td></tr>
                        <tr><td><strong>Benelux</strong></td><td><span class="status-pill pill-good">9.00</span></td><td>Trust, strategic framing, CC relationship (10.0)</td><td>Advisory board candidate; QBR template sharing</td></tr>
                    </tbody>
                </table>`
            },

            'cat10': {
                text: `<div class="cat-content-inner">
                    <div class="cat-insight">
                        <p>At the aggregate level, the data is <strong>statistically robust</strong>. With 91 responses from 117 invited participants (78%), the margin of error at 95% confidence is ±0.31 rating points — meaning the true population score lies between 7.88 and 8.50. The headline figure of 8.19 can be presented to leadership with high confidence.</p>
                        <p>However, <strong>sub-group reliability varies significantly</strong>. Markets with small response counts (Europe/Global n=3; Nordics n=4) should not be treated as statistically reliable. The SAPMENA ZONE score of 6.4 based on n=10 carries a margin of error of ±1.1 — wide enough that the true figure could range from 5.3 to 7.5.</p>
                        <p><strong>Implication:</strong> Directional insights from low-n segments are valid for flagging areas of concern, but specific point estimates should be treated with caution in external reporting.</p>
                    </div>
                </div>`,
                graphic: `<div class="cat-metrics-row">
                    <div class="cat-metric"><div class="cat-metric-value positive">High</div><div class="cat-metric-label">Overall Confidence</div><div class="cat-metric-delta delta-flat">Strong participation</div></div>
                    <div class="cat-metric"><div class="cat-metric-value neutral">±0.31</div><div class="cat-metric-label">Margin of Error</div><div class="cat-metric-delta delta-flat">95% confidence</div></div>
                    <div class="cat-metric"><div class="cat-metric-value neutral">91</div><div class="cat-metric-label">Valid Responses</div><div class="cat-metric-delta delta-flat">From 117 invited</div></div>
                    <div class="cat-metric"><div class="cat-metric-value negative">Low</div><div class="cat-metric-label">SAPMENA Confidence</div><div class="cat-metric-delta delta-flat">Small n = 10</div></div>
                </div>
                <table class="cat-table">
                    <thead><tr><th>Segment</th><th>n</th><th>Rating</th><th>Margin of Error</th><th>Reliability</th></tr></thead>
                    <tbody>
                        <tr><td>Full dataset</td><td>91</td><td>8.19</td><td>±0.31</td><td><span class="status-pill pill-good">HIGH</span></td></tr>
                        <tr><td>Core Cohort</td><td>36</td><td>8.31</td><td>±0.52</td><td><span class="status-pill pill-good">HIGH</span></td></tr>
                        <tr><td>Germany</td><td>22</td><td>8.50</td><td>±0.64</td><td><span class="status-pill pill-neutral">MEDIUM</span></td></tr>
                        <tr><td>SAPMENA ZONE</td><td>10</td><td>6.40</td><td>±1.10</td><td><span class="status-pill pill-warn">LOW</span></td></tr>
                        <tr><td>Nordics</td><td>4</td><td>7.25</td><td>±1.84</td><td><span class="status-pill pill-risk">VERY LOW</span></td></tr>
                        <tr><td>Europe/Global</td><td>3</td><td>7.33</td><td>±2.10</td><td><span class="status-pill pill-risk">VERY LOW</span></td></tr>
                    </tbody>
                </table>`
            }
        };

        function injectCategoryContent(id, animate) {
            const container = document.getElementById(id + '-content');
            if (!container) return;
            const data = categoryContent[id];
            if (!data) return;

            // Inject text insights
            const textDiv = document.createElement('div');
            textDiv.innerHTML = data.text;
            const textInner = textDiv.querySelector('.cat-content-inner');
            if (animate && textInner) textInner.classList.add('animating');

            // Inject graphic data into the graphic-expanded div
            const graphic = container.querySelector('.graphic-expanded');
            if (graphic) {
                const placeholder = graphic.querySelector('.graphic-placeholder');
                if (placeholder) {
                    placeholder.outerHTML = `<div class="mini-chart-area">${data.graphic}</div>`;
                }
            }

            // Replace everything before the graphic div
            container.innerHTML = '';
            if (textInner) container.appendChild(textInner);
            if (graphic) container.appendChild(graphic);
        }

        function populateCategories(withAnimation) {
            const cats = ['cat1','cat2','cat3','cat4','cat5','cat6','cat7','cat8','cat9','cat10'];
            // First reset all to loading skeletons
            if (withAnimation) {
                cats.forEach(id => {
                    const container = document.getElementById(id + '-content');
                    if (!container) return;
                    const graphic = container.querySelector('.graphic-expanded');
                    const skeleton = document.createElement('div');
                    skeleton.className = 'cat-skeleton';
                    skeleton.innerHTML = `<div class="skeleton-line" style="width:60%"></div><div class="skeleton-line" style="width:85%"></div><div class="skeleton-line" style="width:40%"></div>`;
                    container.innerHTML = '';
                    container.appendChild(skeleton);
                    if (graphic) container.appendChild(graphic);
                });
            }
            cats.forEach((id, i) => {
                setTimeout(() => injectCategoryContent(id, withAnimation), withAnimation ? 400 + i * 280 : 0);
            });
        }

        // Populate on load (no animation — already "generated" state for testing)
        document.addEventListener('DOMContentLoaded', () => {
            populateCategories(false);
            const firstSession = document.querySelector('.chat-session');
            if (firstSession) openSession(firstSession, 0);
        });

        // ────────────────────────────────────────────────────────

        function toggleConfig() {
            const content = document.getElementById('configContent');
            const icon = document.getElementById('toggleIcon');
            const summary = document.getElementById('configSummary');
            const header = document.querySelector('.config-header');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('expanded');
                summary.style.display = 'none';
                header.classList.remove('collapsed');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('expanded');
                summary.style.display = 'flex';
                header.classList.add('collapsed');
            }
        }

        function toggleSelectAll(button, type) {
            const selectorGroup = button.closest('.selector-group');
            const checkboxes = selectorGroup.querySelectorAll('.checkbox');
            const isSelectingAll = button.textContent === 'Select All';
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = isSelectingAll;
            });
            
            button.textContent = isSelectingAll ? 'Deselect All' : 'Select All';
        }

        function toggleGraphic(categoryId) {
            const graphic = document.getElementById(categoryId + '-graphic');
            const button = event.currentTarget;
            
            if (graphic.style.display === 'none') {
                graphic.style.display = 'block';
                button.innerHTML = `HIDE GRAPHIC`;
            } else {
                graphic.style.display = 'none';
                button.innerHTML = `SHOW GRAPHIC`;
            }
        }

        // ── Chat openers for all contexts ──────────────────────
        const aiOpeners = {
            'Key Metrics of Significance': "You're looking at the Key Metrics section. The Q4 2025 aggregate of 8.19 (91 responses, 78% response rate) is above the Creative industry benchmark of 8.04 and 22.7pp above the sector response-rate norm. What would you like to explore?",
            'Areas of Risk and Vulnerability': "You're asking about Areas of Risk. The most urgent concern is the silent detractor cluster — 15 participants who rated below 6.0 last round chose not to respond this time. 7 of them are critical contacts. Which area would you like to dig into first?",
            "What's Changed Since Last Round": "The headline shift is +0.86 points — but the underlying sentiment has barely moved. The gain is almost entirely explained by a 17pp jump in response rate. Would you like me to model what the score would look like if participation had stayed flat?",
            'Areas of Celebration and Opportunity': "Iberia, Benelux, Germany, and Greece are all outperforming the global average. The Benelux Critical Contact hit a perfect 10.0. Shall I suggest how to turn these into internal champions for lower-scoring markets?",
            'Performance Trend': "Performance Trend shows Vista Group has moved from 0.71 points below benchmark in Q3 to 0.15 points above it in Q4 — a meaningful turnaround. The response rate improvement from 61% to 78% is the primary driver. Want me to project forward based on current trajectory?",
            'Key Drivers': "The team_name dimension is the dominant driver of rating variance, accounting for 42% of the total spread (eta-squared = 0.42). This means which team a client is assigned to matters more than any other factor. Would you like to see which specific teams are pulling the score up — and which are dragging it down?",
            'Deep Dive Analysis': "The market-level analysis shows a 3.35-point spread between the best (Greece, 9.75) and worst (SAPMENA, 6.40) performing markets. Three markets are below the global average and two are clear champions. Would you like a recommended action for each at-risk market?",
            "Who Didn't Respond": "There are 4 critical contacts who didn't respond this round, including Simon Preuss and Tanguy Delabrouhe from L'Oréal SAPMENA — both of whom rated below 6.0 in Q3. The Italy market is also missing two critical contacts entirely. Should I draft re-engagement outreach for any of these?",
            'Silent Detractor Risk': "15 previous low-raters have gone silent this round — including 7 critical contacts. If they were to respond at their prior average of ~5.2, the headline score would fall from 8.19 to approximately 7.61, dropping below the industry benchmark. Would you like a risk-ranked list of the silent accounts?",
            'Critical Contact Health': "The CC cohort is outperforming the general population on both score (8.36 vs 8.19) and response rate (85% vs 78%). But there are two significant exceptions — Emily Rutherford's 3.0 rating and Simon Preuss's non-response. Want me to prioritise the action list for these accounts?",
            'Feedback Themes': "329 coded references across 91 responses. The sentiment ratio is 3.4:1 positive to improvement. Timeliness (19 mentions), creative quality (17), and team talent (14) are the top praise themes. Reporting accuracy (14) and strategic depth (12) are the top improvement calls. Would you like the full verbatim quotes for any theme?",
            'Partnership &amp; Vision': "The feedback splits nearly evenly between relational (47.6%) and transactional (51.5%) themes — a sign of a solid but not yet deeply strategic partnership. High-scoring markets skew heavily relational; SAPMENA is almost purely transactional. Want ideas on how to shift SAPMENA toward a more strategic framing?",
            'Focus Areas &amp; Opportunities': "Three markets need immediate attention — SAPMENA (6.40, high risk), Nordics (7.25, at risk), and Italy (missing critical contacts). Two champion markets — Iberia and Benelux — are ready to be used as internal mentors. Would you like a structured action plan for any of these?",
            'Confidence in the Data': "At the aggregate level the data is robust — margin of error ±0.31 at 95% confidence. But several sub-groups (SAPMENA n=10, Nordics n=4, Europe/Global n=3) carry wide margins and shouldn't be treated as statistically reliable. Would you like guidance on how to present these caveats to senior leadership?"
        };

        const aiCategoryOpener = (context) =>
            `You're asking about <strong>${context}</strong>. I've analysed the Q4 2025 data for this category. What specific aspect would you like to explore — the key findings, market comparisons, or recommended actions?`;

        function openChat(context) {
            const panel = document.getElementById('chatPanel');
            const overlay = document.getElementById('chatOverlay');
            const messages = document.getElementById('chatMessages');
            const title = document.getElementById('chatPanelTitle');
            const ctx = document.getElementById('chatPanelContext');
            const ctxTag = document.getElementById('chatContextTag');

            title.textContent = 'AI Chat';
            ctx.textContent = context;
            ctxTag.innerHTML = `<svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Context: ${context}`;

            const opener = aiOpeners[context] || aiCategoryOpener(context);
            messages.innerHTML = `
                <div class="chat-msg ai">
                    <div class="chat-msg-label">VERITY AI</div>
                    <div class="chat-msg-bubble">${opener}</div>
                </div>`;

            panel.classList.add('open');
            overlay.classList.add('open');
            document.getElementById('chatInput').focus();
        }

        function closeChat() {
            document.getElementById('chatPanel').classList.remove('open');
            document.getElementById('chatOverlay').classList.remove('open');
        }

        function handleChatKey(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');
            const text = input.value.trim();
            if (!text) return;

            messages.innerHTML += `
                <div class="chat-msg user">
                    <div class="chat-msg-label">YOU</div>
                    <div class="chat-msg-bubble">${text}</div>
                </div>`;
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            const typingId = 'typing-' + Date.now();
            messages.innerHTML += `
                <div class="chat-msg ai" id="${typingId}">
                    <div class="chat-msg-label">VERITY AI</div>
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>`;
            messages.scrollTop = messages.scrollHeight;

            setTimeout(() => {
                const el = document.getElementById(typingId);
                if (el) el.querySelector('.typing-indicator').outerHTML = `<div class="chat-msg-bubble">Based on the current data, I'd recommend looking closely at the SAPMENA ZONE performance alongside the silent detractor flags — together they point to a concentrated risk cluster worth addressing in the next action plan. Would you like me to draft suggested talking points for the account team?</div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 1600);
        }

        // ── Generate Insights with live progress bar ─────────────
        const generateSteps = [
            'Analysing survey responses…',
            'Calculating performance trends…',
            'Identifying key drivers…',
            'Mapping market deep dive…',
            'Flagging non-responders…',
            'Modelling silent detractor risk…',
            'Evaluating critical contact health…',
            'Extracting feedback themes…',
            'Assessing partnership signals…',
            'Identifying focus opportunities…',
            'Running confidence analysis…',
            'Compiling executive summary…'
        ];

        function applyConfiguration() {
            const btn = event.target.closest('button');
            btn.innerHTML = '<span class="loading-spinner"></span> GENERATING...';
            btn.disabled = true;

            // Show progress bar
            let progressBar = document.getElementById('generateProgress');
            if (!progressBar) {
                progressBar = document.createElement('div');
                progressBar.id = 'generateProgress';
                progressBar.className = 'generate-progress';
                progressBar.innerHTML = `
                    <div class="gp-bar-track"><div class="gp-bar-fill" id="gpFill"></div></div>
                    <div class="gp-status" id="gpStatus">${generateSteps[0]}</div>`;
                document.getElementById('actionBar').after(progressBar);
            }
            progressBar.style.display = 'flex';

            let step = 0;
            const totalSteps = generateSteps.length;
            const interval = setInterval(() => {
                step++;
                const pct = Math.round((step / totalSteps) * 100);
                document.getElementById('gpFill').style.width = pct + '%';
                document.getElementById('gpStatus').textContent = generateSteps[Math.min(step, totalSteps - 1)];
                if (step >= totalSteps) {
                    clearInterval(interval);
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        btn.innerHTML = 'REGENERATE INSIGHTS';
                        btn.disabled = false;
                        // Update timestamp
                        const now = new Date();
                        const ts = now.toLocaleString('en-GB', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit', timeZoneName:'short' });
                        document.getElementById('dataSummary').querySelector('div:first-child').innerHTML = `<strong>Generated:</strong> ${ts}`;
                        // Re-populate categories with animation
                        populateCategories(true);
                        // Collapse config
                        if (!document.getElementById('configContent').classList.contains('hidden')) {
                            toggleConfig();
                        }
                    }, 400);
                }
            }, 200);
        }
    </script>
    <!-- Chat Overlay + Panel -->
    <div class="chat-overlay" id="chatOverlay" onclick="closeChat()"></div>

    <div class="chat-panel" id="chatPanel">
        <div class="chat-panel-header">
            <div>
                <div class="chat-panel-title" id="chatPanelTitle">Chat</div>
                <div class="chat-panel-context" id="chatPanelContext">VerityRI AI Insights</div>
            </div>
            <button class="chat-close-btn" onclick="closeChat()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Messages injected by JS -->
        </div>

        <div class="chat-input-area">
            <div class="chat-context-tag" id="chatContextTag">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                Context: Executive Summary
            </div>
            <div class="chat-input-row">
                <textarea class="chat-input" id="chatInput" rows="2" placeholder="Ask a follow-up question…" onkeydown="handleChatKey(event)"></textarea>
                <button class="chat-send-btn" onclick="sendChatMessage()">SEND</button>
            </div>
        </div>
    </div>

</body>
</html>
